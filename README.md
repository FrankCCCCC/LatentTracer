# Latent Tracer

This repository is the source code for "How to Trace Latent Diffusion Generated Images without Artificial Watermark?".

# Environment
see requirements.txt

# Generating Images

For example, generating images using Stable Diffusion v1-5:
```bash
python generate_samples_all.py --arch sd --save_dir ./sdv15_generated_imgs/
```
Generating images using Stable Diffusion v2-base:
```bash
python generate_samples_all.py --arch sdv2base --save_dir ./sdv2base_generated_imgs/
```

# Reverse-engineering
For example, to conduct reverse-engineering on the belonging images of Stable Diffusion Stable Diffusion v2-base:
```bash
python run_write_re_loss_to_txt.py --gpu 4 --filePath ./sdv2base_generated_imgs/ --model_type sdv2base --lr 0.05 \
--num_iter 100 --write_txt_path ./ReconstructionLosses_Model_sdv2base_Images_sdv2baseGenerated.txt
```

To conduct reverse-engineering on the non-belonging images (images generated by Stable Diffusion v1-5 here):
```bash
python run_write_re_loss_to_txt.py --gpu 4 --filePath ./sdv15_generated_imgs/ --model_type sdv2base --lr 0.05 \
--num_iter 100 --write_txt_path ./ReconstructionLosses_Model_sdv2base_Images_sdv15Generated.txt
```

# Visualization the Distributions of the Reconstruction Losses

```bash
python draw_distributions_from_txt.py \
--txt_1 ./ReconstructionLosses_Model_sdv2base_Images_sdv2baseGenerated.txt \
--txt_2 ./ReconstructionLosses_Model_sdv2base_Images_sdv15Generated.txt \
--label_1 'Belongings' \
--label_2 'Non-belongings' \
--save_name ./distribution.pdf
```